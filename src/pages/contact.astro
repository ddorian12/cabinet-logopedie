---
import Layout from "../layouts/Layout.astro";
---
<Layout title="Contact â€“ ProgramÄƒri" description="Contact & programÄƒri pentru evaluare È™i terapie logopedicÄƒ.">
  <section class="relative max-w-4xl mx-auto px-6 py-20">
    <!-- Decorative Orbs -->
    <div aria-hidden="true" class="absolute w-80 h-80 bg-linear-to-br from-indigo-400/20 to-purple-400/20 rounded-full top-0 left-0 blur-3xl animate-pulse"></div>
    <div aria-hidden="true" class="absolute w-64 h-64 bg-linear-to-br from-pink-400/20 to-orange-400/20 rounded-full bottom-10 right-0 blur-3xl animate-pulse delay-1000"></div>

    <!-- Header -->
    <div class="text-center mb-12">
      <div class="mx-auto w-max px-5 py-3 rounded-full bg-white/80 backdrop-blur-md text-indigo-600 font-semibold text-sm mb-6 shadow-neumorphic" aria-hidden="true">
        ðŸ“ž Contact & programÄƒri
      </div>
      <h1 class="block text-4xl md:text-5xl font-extrabold bg-linear-to-r from-indigo-600 to-purple-500 bg-clip-text text-transparent leading-[1.18] md:leading-[1.12] pb-2">
        ProgrameazÄƒ o consultaÈ›ie
      </h1>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
        CompleteazÄƒ formularul de mai jos È™i te vom contacta pentru a stabili detaliile.
      </p>
    </div>

    <!-- Contact Form -->
    <div class="group bg-white/80 backdrop-blur-md rounded-3xl p-8 shadow-neumorphic hover:shadow-xl transition-all duration-300">
      <form id="contact-form" action="/api/contact" method="POST" class="space-y-6" novalidate>
        <!-- anti-spam & meta -->
        <input type="hidden" name="_subject" value="Cerere programare â€“ site" />
        <input type="hidden" name="_redirect" value="/multumim" />
        <input type="text" name="_gotcha" tabindex="-1" autocomplete="off" class="hidden" />

        <!-- Nume -->
        <div>
          <label for="name" class="block text-sm font-medium text-gray-900 mb-2">Nume*</label>
          <input
            id="name"
            name="name"
            required
            autocomplete="name"
            inputmode="text"
            pattern="^[A-Za-zÄ‚Ã‚ÃŽÈ˜ÈšÄƒÃ¢Ã®È™È› \-']{2,}$"
            title="IntroduceÈ›i cel puÈ›in 2 caractere: litere (inclusiv diacritice), spaÈ›ii, cratimÄƒ sau apostrof."
            class="peer w-full rounded-xl border border-gray-200 p-4 bg-white/50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
            aria-describedby="name-error"
          />
          <p id="name-error" class="mt-2 text-sm text-red-600 hidden">IntroduceÈ›i un nume valid (minim 2 caractere, doar litere È™i spaÈ›ii).</p>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <!-- Email -->
          <div>
            <label for="email" class="block text-sm font-medium text-gray-900 mb-2">Email*</label>
            <input
              id="email"
              type="email"
              name="email"
              required
              autocomplete="email"
              pattern="^[^\s@]+@[^\s@]+\.[^\s@]{2,}$"
              title="FolosiÈ›i un format de email valid, ex: nume@domeniu.ro"
              class="peer w-full rounded-xl border border-gray-200 p-4 bg-white/50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
              aria-describedby="email-error"
            />
            <p id="email-error" class="mt-2 text-sm text-red-600 hidden">IntroduceÈ›i un email valid (ex: nume@domeniu.ro).</p>
          </div>

          <!-- Telefon -->
          <div>
            <label for="phone" class="block text-sm font-medium text-gray-900 mb-2">Telefon</label>
            <input
              id="phone"
              name="phone"
              type="tel"
              inputmode="tel"
              autocomplete="tel"
              pattern="^\+?[0-9\s().\-]{7,15}$"
              title="Doar cifre È™i simboluri + ( ) - . spaÈ›ii, 7â€“15 caractere."
              class="peer w-full rounded-xl border border-gray-200 p-4 bg-white/50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
              aria-describedby="phone-error"
            />
            <p id="phone-error" class="mt-2 text-sm text-red-600 hidden">NumÄƒr de telefon invalid (doar cifre È™i + ( ) - . spaÈ›ii, 7â€“15 caractere).</p>
          </div>
        </div>

        <!-- Interval preferat -->
        <div>
          <label for="slot" class="block text-sm font-medium text-gray-900 mb-2">PreferinÈ›Äƒ zi/interval</label>
          <input
            id="slot"
            name="slot"
            placeholder="*VÄƒ rugÄƒm verificaÈ›i programul de pe pagina 'Despre'*"
            autocomplete="off"
            class="w-full rounded-xl border border-gray-200 p-4 bg-white/50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
          />
        </div>

        <!-- Mesaj -->
        <div>
          <label for="message" class="block text-sm font-medium text-gray-900 mb-2">Mesaj*</label>
          <textarea
            id="message"
            name="message"
            rows="5"
            required
            minlength="10"
            title="ScrieÈ›i un mesaj de minim 10 caractere."
            class="peer w-full rounded-xl border border-gray-200 p-4 bg-white/50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
            aria-describedby="message-error"
          ></textarea>
          <p id="message-error" class="mt-2 text-sm text-red-600 hidden">Mesajul trebuie sÄƒ aibÄƒ cel puÈ›in 10 caractere.</p>
        </div>

        <!-- GDPR -->
        <label class="flex items-start gap-3 text-sm text-gray-600">
          <input
            required
            type="checkbox"
            name="gdpr"
            class="mt-1 h-5 w-5 text-indigo-600 border-gray-200 rounded focus:ring-indigo-500"
            aria-describedby="gdpr-error"
          />
          <span>
            Sunt de acord cu prelucrarea datelor conform
            <a class="underline hover:text-indigo-600 transition-colors" href="/politica-confidentialitate">Politicii de confidenÈ›ialitate</a>.
          </span>
        </label>
        <p id="gdpr-error" class="mt-2 text-sm text-red-600 hidden">Trebuie sÄƒ accepÈ›i politica de confidenÈ›ialitate.</p>

        <!-- Submit -->
        <button id="submit-btn" type="submit" class="inline-flex items-center gap-3 bg-linear-to-r from-indigo-600 to-purple-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300">
          <span>Trimite</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </button>
      </form>
    </div>
  </section>

  <style>
    .shadow-neumorphic {
      box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.1), -10px -10px 20px rgba(255, 255, 255, 0.7);
    }
    @media (prefers-reduced-motion: reduce) {
      .animate-pulse { animation: none !important; }
      .hover\:scale-105:hover { transform: none !important; }
    }
  </style>

  <!-- ValidÄƒri client-side Ã®n JavaScript pur (fÄƒrÄƒ TS adnotations) -->
  <script is:inline>
    (function () {
      const form = document.querySelector('form[action="/api/contact"]');
      const submitBtn = document.querySelector('#submit-btn');

      if (!(form instanceof HTMLFormElement)) {
        console.warn('Formularul de contact nu a fost gÄƒsit.');
        return;
      }

      // elemente
      const nameInput   = document.getElementById('name');
      const emailInput  = document.getElementById('email');
      const phoneInput  = document.getElementById('phone');
      const messageArea = document.getElementById('message');
      const gdprBox     = form.querySelector('input[name="gdpr"]');

      // helpers
      function showError(input, errorId, text) {
        input.classList.remove('border-gray-200');
        input.classList.add('border-red-500');
        const p = document.getElementById(errorId);
        if (p) p.classList.remove('hidden');
        if (typeof input.setCustomValidity === 'function') input.setCustomValidity(text || 'CÃ¢mp invalid');
      }

      function clearError(input, errorId) {
        input.classList.remove('border-red-500');
        input.classList.add('border-gray-200');
        const p = document.getElementById(errorId);
        if (p) p.classList.add('hidden');
        if (typeof input.setCustomValidity === 'function') input.setCustomValidity('');
      }

      // validatori
      function vName(el) {
        const ok = /^[A-Za-zÃ€-Ã–Ã˜-Ã¶Ã¸-Ã¿Ä‚Ã‚ÃŽÈ˜ÈšÄƒÃ¢Ã®È™È› \-']{2,}$/.test(el.value.trim());
        ok ? clearError(el, 'name-error') : showError(el, 'name-error', 'Te rugÄƒm introdu un nume valid (minim 2 caractere).');
        return ok;
      }

      function vEmail(el) {
        const ok = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(el.value.trim());
        ok ? clearError(el, 'email-error') : showError(el, 'email-error', 'Te rugÄƒm introdu un email valid (ex: nume@domeniu.ro).');
        return ok;
      }

      function vPhone(el) {
        if (!el.value.trim()) { clearError(el, 'phone-error'); return true; } // opÈ›ional
        const ok = /^\+?[0-9\s().\-]{7,15}$/.test(el.value.trim());
        ok ? clearError(el, 'phone-error') : showError(el, 'phone-error', 'Telefon invalid (7â€“15 caractere).');
        return ok;
      }

      function vMessage(el) {
        const ok = el.value.trim().length >= 10;
        ok ? clearError(el, 'message-error') : showError(el, 'message-error', 'Mesajul trebuie sÄƒ aibÄƒ cel puÈ›in 10 caractere.');
        return ok;
      }

      function vGDPR() {
        const ok = gdprBox && gdprBox.checked;
        if (gdprBox && typeof gdprBox.setCustomValidity === 'function') {
          gdprBox.setCustomValidity(ok ? '' : 'Trebuie sÄƒ accepÈ›i prelucrarea datelor.');
        }
        const p = document.getElementById('gdpr-error');
        if (p) p.classList[ok ? 'add' : 'remove']('hidden');
        return !!ok;
      }

      // feedback live
      nameInput?.addEventListener('input',   () => vName(nameInput));
      emailInput?.addEventListener('input',  () => vEmail(emailInput));
      phoneInput?.addEventListener('input',  () => vPhone(phoneInput));
      messageArea?.addEventListener('input', () => vMessage(messageArea));
      gdprBox?.addEventListener('change',    () => vGDPR());

      // blocheazÄƒ caractere nepermise la telefon
      phoneInput?.addEventListener('beforeinput', (ev) => {
        if (ev.data && /[^\d+\s().-]/.test(ev.data)) ev.preventDefault();
      });

      // submit
      form.addEventListener('submit', (e) => {
        const ok =
          vName(nameInput) &&
          vEmail(emailInput) &&
          vPhone(phoneInput) &&
          vMessage(messageArea) &&
          vGDPR();

        if (!ok) {
          e.preventDefault();
          const firstInvalid = [nameInput, emailInput, phoneInput, messageArea, gdprBox]
            .find(el => el && typeof el.checkValidity === 'function' && !el.checkValidity());
          firstInvalid?.scrollIntoView({ behavior: 'smooth', block: 'center' });
          if (typeof form.reportValidity === 'function') form.reportValidity(); // âœ… sigur
          return;
        }

        // UX: dezactiveazÄƒ butonul pe durata submit-ului
        submitBtn?.setAttribute('disabled', 'true');
        submitBtn?.classList.add('opacity-70', 'cursor-not-allowed');
      });
    })();
  </script>
</Layout>
